<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>추천영상 등록 - ArkTube</title>

  <!-- CSP: 요청하신 정책 그대로 -->
  <meta http-equiv="Content-Security-Policy" content="
  default-src 'self';

  connect-src 'self'
    https://www.googleapis.com
    https://firestore.googleapis.com
    https://securetoken.googleapis.com
    https://identitytoolkit.googleapis.com
    https://firebaseinstallations.googleapis.com
    https://firebase.googleapis.com
    https://www.gstatic.com
    https://www.google-analytics.com
    https://www.youtube.com
    https://i.ytimg.com;

  img-src 'self' data:
    https://i.ytimg.com
    https://www.google-analytics.com;

  frame-src
    https://www.youtube.com
    https://www.youtube-nocookie.com
    https://accounts.google.com
    https://www.google.com
    https://theark-3c896.firebaseapp.com
    https://theark-3c896.web.app;

  script-src 'self'
    https://www.gstatic.com
    https://apis.google.com
    https://www.googletagmanager.com
    'unsafe-inline';

  style-src 'self' 'unsafe-inline';
  object-src 'none';
  base-uri 'self';
">

  <link rel="stylesheet" href="/css/style.css"/>

  <style>
    body{ padding-top:52px; }
    main.intro{ align-items:flex-start; padding-top:48px; }
    .controls-grid{
      display:grid;
      grid-template-columns:minmax(160px,40%) 1fr 1fr;
      grid-template-rows:auto auto;
      gap:10px; align-items:stretch; margin:10px 0 8px;
    }
    .order-col{ display:grid; grid-template-rows:1fr 1fr; gap:10px; }
    .pill-radio{
      display:flex; align-items:center; gap:10px;
      padding:12px 14px; border-radius:10px;
      background:#121212; border:1px solid #2a2a2a; color:#e5e7eb; font-weight:700;
    }
    .pill-radio input{ accent-color:#4ea1ff; transform:scale(1.1); }
    .btn-clip,.btn-submit{
      grid-row:span 2; display:flex; align-items:center; justify-content:center; text-align:center;
      border:0; border-radius:12px; cursor:pointer; font-weight:800; line-height:1.2;
      padding:0 12px; min-height:96px;
    }
    @media (min-width:900px){ .btn-clip,.btn-submit{ min-height:110px; } }
    .btn-clip{ background:#22c55e; color:#000; font-size:16px; }
    .btn-submit{ background:#4ea1ff; color:#fff; font-size:16px; }
    .msg{ margin-top:10px; font-size:13px; color:#ccc; white-space:pre-line; min-height:1.2em; }

    /* urlfind 모달 */
    .urlfind-dialog{ border:0; border-radius:14px; padding:0; background:transparent; }
    .urlfind-dialog::backdrop{ background:rgba(0,0,0,.6); }
    .urlfind-dialog .panel{
      background:#0f0f0f; color:#e5e7eb; border:1px solid #2a2a2a; border-radius:14px;
      padding:12px; width:min(680px, 92vw);
    }
    .urlfind-dialog header{ display:flex; align-items:center; justify-content:space-between; margin-bottom:8px; }
    .urlfind-dialog .row{ display:flex; gap:8px; flex-wrap:wrap; margin:8px 0; }
    .urlfind-dialog input[type="text"]{ width:100%; padding:8px 10px; border:1px solid #333; border-radius:8px; background:#000; color:#fff; }
    .urlfind-dialog textarea{ width:100%; min-height:220px; padding:10px; border:1px solid #333; border-radius:8px; background:#000; color:#fff; }
    .urlfind-dialog .btn-primary{ padding:8px 12px; border-radius:10px; border:0; background:#4ea1ff; color:#fff; font-weight:800; cursor:pointer; }
    .urlfind-dialog .btn{ padding:8px 12px; border-radius:10px; border:1px solid #2a2a2a; background:#151515; color:#fff; cursor:pointer; }
    .urlfind-dialog .icon.close{ border:1px solid #2a2a2a; background:#151515; color:#ddd; border-radius:8px; padding:4px 8px; cursor:pointer; }

    /* 상단바 dropdown 강조 두 항목 */
    #dropdownMenu .menu-strong{ font-weight:800; font-size:16px; }
  </style>

  <!-- PWA -->
  <link rel="manifest" href="/manifest.webmanifest">
  <meta name="theme-color" content="#000000">
  <link rel="icon" href="/image/arktube_icon_32b.png">
  <link rel="apple-touch-icon" href="/image/arktube_icon_192b.png">
</head>
<body>
  <!-- 상단바 -->
  <header id="topbar">
    <div class="brand">
      <a id="brandHome" href="/index.html" aria-label="ArkTube 홈으로">
        <img class="brand-logo" src="/image/arktube_side.png" alt="ArkTube"/>
      </a>
    </div>
    <div class="right" style="position:relative;">
      <a id="signupLink" class="link" href="/signup.html">Sign up</a>
      <a id="signinLink" class="link" href="/signin.html">Sign in</a>
      <span id="welcome" class="welcome"></span>
      <button id="menuBtn" class="icon" aria-label="menu">三</button>
      <div id="dropdownMenu" class="dropdown hidden" role="menu" aria-hidden="true">
        <button id="btnAbout"     class="menu-strong" type="button">ArkTube는…</button>
        <button id="btnCatOrder"  type="button">카테고리순서</button>
        <button id="btnMyUploads" type="button">내영상관리</button>
        <button id="btnSignOut"   type="button">Sign out</button>
        <button id="btnList"      type="button">영상목록</button>
        <button id="btnGoUpload"  class="menu-strong" type="button">추천영상등록</button>
        <hr class="custom-separator"/>
        <button id="menu-playlist-url" type="button" style="font-weight:bold;">Playlist URL 추출</button>
      </div>
    </div>
  </header>

  <main class="intro">
    <div style="max-width:900px; width:100%; text-align:left;">
      <h2>추천영상 등록</h2>

      <label style="display:block;margin-top:14px;">YouTube 공유 URL들 (여러 줄 가능)
        <textarea id="urls" rows="3" placeholder="https://youtu.be/aaa...&#10;https://www.youtube.com/watch?v=bbb...&#10;..." style="width:100%;padding:12px;margin-top:6px;border-radius:8px;border:1px solid #333;background:#000;color:#fff;"></textarea>
      </label>

      <div class="controls-grid" id="controlsGrid">
        <div class="order-col">
          <label class="pill-radio"><input type="radio" name="order" value="bottom" checked> 아래부터 등록</label>
          <label class="pill-radio"><input type="radio" name="order" value="top"> 위부터 등록</label>
        </div>
        <button id="btnPaste" class="btn-clip" type="button" title="클립보드에서 붙여넣기">클립보드<br/>붙여넣기</button>
        <button id="btnSubmitTop" class="btn-submit" type="button">등록</button>
      </div>

      <div id="msgTop" class="msg"></div>

      <p style="margin:10px 0 6px;color:#bfc6ce;">카테고리는 <b>최대 3개</b>까지 선택 가능합니다. (개인자료는 단독 사용)</p>
      <div id="cats"></div>

      <button id="btnSubmitBottom" class="btn-submit" type="button" style="width:100%;margin-top:10px;min-height:56px;">등록</button>
      <div id="msg" class="msg"></div>
    </div>
  </main>

  <!-- Playlist URL 추출 모달 (urlfind.js가 초기화) -->
  <dialog id="dlg-urlfind" class="urlfind-dialog">
    <form method="dialog" class="panel">
      <header>
        <strong>Playlist URL 추출</strong>
        <button type="submit" class="icon close" aria-label="닫기">✕</button>
      </header>

      <label class="block">
        <span>재생목록 전체 URL</span>
        <input type="text" id="uf_playlistUrl" placeholder="https://www.youtube.com/playlist?list=..." />
      </label>

      <label class="inline" style="display:flex;align-items:center;gap:8px;">
        <input type="checkbox" id="uf_useShortUrl" />
        <span>youtu.be 공유 URL 형식으로 출력</span>
      </label>

      <div class="row">
        <button type="button" id="uf_extractBtn" class="btn-primary">URL 추출 시작</button>
        <button type="button" id="uf_copyBtn" class="btn">클립보드 복사</button>
        <button type="button" id="uf_downloadBtn" class="btn">TXT 다운로드</button>
      </div>

      <div id="uf_loading" class="muted hidden">추출 중입니다...</div>
      <textarea id="uf_result" readonly placeholder="이곳에 동영상 URL 목록이 표시됩니다."></textarea>
      <div class="muted" style="margin-top:6px;">Tip: 결과 상자를 더블클릭하면 업로드 입력칸(#urls)으로 자동 적용됩니다.</div>
    </form>
  </dialog>

  <!-- 모듈 -->
  <script type="module" src="/js/firebase-init.js"></script>
  <script type="module" src="/js/auth.js"></script>
  <script type="module" src="/js/categories.js"></script>
  <script type="module" src="/js/youtube-utils.js"></script>
  <script type="module" src="/js/urlfind.js"></script>
  <script type="module" src="/js/upload.js"></script>
</body>
</html>
