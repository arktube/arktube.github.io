<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
  <title>ArkTube - 영상 보기</title>

  <!-- CSP: YouTube IFrame + Firebase(Auth/Firestore) + (선택) gtag (네가 준 기존안 그대로) -->
  <meta http-equiv="Content-Security-Policy" content="
    default-src 'self';
    base-uri 'self';
    object-src 'none';

    style-src 'self' 'unsafe-inline';
    font-src 'self' data:;
    manifest-src 'self';

    script-src 'self' https://www.gstatic.com https://www.youtube.com https://s.ytimg.com https://www.googletagmanager.com 'unsafe-inline';
    script-src-elem 'self' https://www.gstatic.com https://www.youtube.com https://s.ytimg.com https://www.googletagmanager.com 'unsafe-inline';
    connect-src 'self'
      https://www.googleapis.com
      https://firestore.googleapis.com
      https://securetoken.googleapis.com
      https://identitytoolkit.googleapis.com
      https://firebaseinstallations.googleapis.com
      https://firebase.googleapis.com
      https://www.gstatic.com
      https://www.youtube.com
      https://s.ytimg.com
      https://www.google-analytics.com
      https://www.googletagmanager.com;

    img-src 'self' data: https://i.ytimg.com https://www.google-analytics.com;

    frame-src https://www.youtube.com https://www.youtube-nocookie.com https://accounts.google.com https://www.google.com;
    child-src https://www.youtube.com https://www.youtube-nocookie.com https://accounts.google.com https://www.google.com;

    frame-ancestors 'self';
  ">

  <link rel="stylesheet" href="./css/style.css"/>

  <style>
    :root{ --pad:12px; --safe-bottom: env(safe-area-inset-bottom, 0px); }
    html,body{ height:100%; }
    body{ margin:0; background:#000; color:#fff; }

    /* 상단바: 프로젝트 공통 구조 + 배경만 투명, 보더 제거 */
    .topbar{
      position:sticky; top:0; z-index:1000;
      display:flex; align-items:center; justify-content:space-between;
      padding:8px 12px;
      background:transparent;            /* ← 투명 */
      border-bottom:none;                /* ← 보더 제거 */
    }
    .brand{ display:flex; align-items:center; gap:8px; text-decoration:none; }
    .brand-logo{ height:44px; }
    @media (max-width:420px){ .brand-logo{ height:38px; } }

    .right{ display:flex; align-items:center; gap:10px; position:relative; }
    .link{ text-decoration:none; color:#fff; font-size:14px; opacity:.9; }
    .welcome{ font-size:14px; color:#fff; opacity:.85; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
    .nick{ font-size:14px; color:#fff; opacity:.95; white-space:nowrap; max-width:32vw; overflow:hidden; text-overflow:ellipsis; }

    /* 드롭다운 트리거 */
    #btnMenu{
      width:36px; height:36px; display:inline-flex; align-items:center; justify-content:center;
      border:1px solid #333; background:#111; color:#fff;
      border-radius:10px; cursor:pointer;
    }

    /* 드롭다운 (watch.js가 토글) */
    .dropdown{
      position:absolute; right:0; top:calc(100% + 6px); min-width:180px; z-index:1001;
      background:#111; color:#fff; border:1px solid #333;
      border-radius:12px; padding:6px; box-shadow:0 8px 20px rgba(0,0,0,.35);
      transform-origin:top right; opacity:0; transform:translateY(-4px) scale(.98);
      pointer-events:none; transition:opacity .15s, transform .15s;
    }
    .dropdown.open{ opacity:1; transform:translateY(0) scale(1); pointer-events:auto; }
    .dropdown.hidden{ display:block; opacity:0; pointer-events:none; }
    .dropdown button,.dropdown a{
      width:100%; text-align:left; border:0; background:transparent; color:#fff;
      padding:8px 10px; border-radius:8px; cursor:pointer; font-size:14px; display:block; text-decoration:none;
    }
    .dropdown .menu-strong{ font-weight:700; }
    .dropdown button:hover,.dropdown a:hover{ background:#1b1b1b; }
    .dropdown hr{ border:0; border-top:1px solid #333; margin:6px 0; }

    /* 본문: 플레이어 컨테이너(16:9를 화면에 예쁘게 맞춤) */
    .wrap{ max-width:1100px; margin:0 auto; padding:var(--pad); padding-bottom: calc(var(--pad) + var(--safe-bottom)); }
    .player-box{ position:relative; width:100%; aspect-ratio:16/9; background:#000; border-radius:12px; overflow:hidden; }
    #player{ width:100%; height:100%; }

    /* 테두리 포커스 제거(공통) */
    :where(button, a, input, textarea):focus { outline: none; }
  </style>

  <!-- YouTube IFrame API (watch.js에서 사용) -->
  <script>
    (function(){ const s=document.createElement('script'); s.src='https://www.youtube.com/iframe_api'; document.head.appendChild(s); })();
  </script>
</head>
<body>
  <!-- 상단바 (Enjoy! 고정, 닉/로그인/메뉴는 공통) -->
  <header class="topbar">
    <a class="brand" id="brandHome" href="./index.html" aria-label="ArkTube 홈으로">
      <img class="brand-logo" src="./image/arktube_side.png" alt="ArkTube"/>
    </a>

    <div class="right">
      <a id="signupLink" class="link" href="./signup.html">Sign up</a>
      <a id="signinLink" class="link" href="./signin.html">Sign in</a>
      <span id="welcomeText" class="welcome">Enjoy!</span>
      <span id="nickName" class="nick"></span>
      <button id="btnMenu" class="icon" aria-label="menu" aria-expanded="false">三</button>

      <!-- watch.js가 제어하는 드롭다운 -->
      <div id="dropdownMenu" class="dropdown hidden" role="menu" aria-hidden="true">
        <button id="btnAbout"       type="button">소개</button>
        <button id="btnGoCategory"  class="menu-strong" type="button">카테고리 선택</button>
        <button id="btnMyUploads"   type="button">내 업로드</button>
        <button id="btnSignOut"     type="button" style="display:none;">Sign out</button>
        <hr/>
        <button id="btnList"        type="button">영상목록</button>
        <button id="btnGoUpload"    class="menu-strong" type="button">추천영상등록</button>
      </div>
    </div>
  </header>

  <!-- 본문: 플레이어 -->
  <main class="wrap">
    <div class="player-box" id="playerBox">
      <div id="player"></div>
    </div>
  </main>

  <!-- Firebase / Auth -->
  <script type="module" src="./js/firebase-init.js"></script>
  <script type="module" src="./js/auth.js"></script>

  <!-- 페이지 스크립트 -->
  <script type="module" src="./js/watch.js"></script>
</body>
</html>
